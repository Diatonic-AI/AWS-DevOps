# Client Billing Portal - Deployment Summary

**Deployment Date:** 2025-12-24 11:54:23 UTC
**AWS Region:** us-east-1
**Account ID:** 313476888312

## Deployed Resources

### Lambda Functions

1. **client-billing-costs**
   - Runtime: Node.js 20.x
   - Function: Fetch costs from Cost Explorer API
   - ARN: arn:aws:lambda:us-east-1:313476888312:function:client-billing-costs

2. **client-billing-payment**
   - Runtime: Node.js 20.x
   - Function: Stripe payment processing
   - ARN: arn:aws:lambda:us-east-1:313476888312:function:client-billing-payment

### API Gateway

- **API ID:** 2ljfykr22k
- **API URL:** https://2ljfykr22k.execute-api.us-east-1.amazonaws.com/prod
- **Endpoints:**
  - GET https://2ljfykr22k.execute-api.us-east-1.amazonaws.com/prod/costs - Fetch client costs
  - POST https://2ljfykr22k.execute-api.us-east-1.amazonaws.com/prod/payment - Payment processing

### DynamoDB Table

- **Table Name:** client-billing-data
- **Purpose:** Store billing data and Stripe customer info

### Client Portal

- **Location:** /home/daclab-ai/DEV/AWS-DevOps/client-portal/public/
- **Entry Point:** index.html

## Next Steps

### 1. Set Up Stripe

Create a Stripe account and save API keys:

```bash
aws secretsmanager create-secret \
    --name client-billing/stripe-api-key \
    --secret-string '{"apiKey":"sk_live_YOUR_KEY_HERE"}' \
    --region us-east-1
```

### 2. Deploy Client Portal

**Option A: Amplify Hosting (Recommended)**

```bash
# Create new Amplify app
aws amplify create-app \
    --name client-billing-portal \
    --repository https://github.com/YOUR-ORG/client-billing-portal \
    --region us-east-2

# Or use manual deployment
cd /home/daclab-ai/DEV/AWS-DevOps/client-portal
zip -r portal.zip public/
# Upload to Amplify Console
```

**Option B: S3 + CloudFront**

```bash
# Create S3 bucket
aws s3 mb s3://client-billing-portal-313476888312 --region us-east-1

# Enable static website hosting
aws s3 website s3://client-billing-portal-313476888312 \
    --index-document index.html

# Upload files
aws s3 sync /home/daclab-ai/DEV/AWS-DevOps/client-portal/public/ \
    s3://client-billing-portal-313476888312/

# Create CloudFront distribution (see AWS Console)
```

### 3. Configure Cost Allocation Tags

Wait 24 hours for tags to appear in Cost Explorer, then activate them:

```bash
aws ce update-cost-allocation-tags-status \
    --cost-allocation-tags-status \
    Key=ClientOrganization,Status=Active \
    Key=BillingProject,Status=Active
```

### 4. Set Up Automated Monthly Billing

Create EventBridge rule for monthly invoicing:

```bash
# Create rule that triggers on 1st of each month
aws events put-rule \
    --name monthly-client-billing \
    --schedule-expression "cron(0 0 1 * ? *)" \
    --region us-east-1

# Add Lambda target (create invoicing Lambda first)
aws events put-targets \
    --rule monthly-client-billing \
    --targets "Id"="1","Arn"="arn:aws:lambda:us-east-1:313476888312:function:monthly-invoice-generator" \
    --region us-east-1
```

## Client Access

### For MMP Toledo:

1. **Portal URL:** [YOUR_AMPLIFY_URL or CloudFront URL]
2. **Client ID:** mmp-toledo
3. **Organization Tag:** MMP-Toledo

### Login Credentials:

- No traditional login required
- Access via unique URL per client
- Option to add authentication (Cognito) later

## Testing

### Test Cost API:

```bash
curl "https://2ljfykr22k.execute-api.us-east-1.amazonaws.com/prod/costs?clientOrganization=MMP-Toledo&period=current-month"
```

### Test Payment Setup:

```bash
curl -X POST https://2ljfykr22k.execute-api.us-east-1.amazonaws.com/prod/payment \
    -H "Content-Type: application/json" \
    -d '{
        "action": "setup-payment-method",
        "clientId": "mmp-toledo",
        "clientName": "Minute Man Press Toledo",
        "email": "aws+minute-man-press@dacvisuals.com",
        "portalUrl": "https://your-portal-url.com"
    }'
```

## Monitoring

### CloudWatch Logs:

- /aws/lambda/client-billing-costs
- /aws/lambda/client-billing-payment

### Metrics to Monitor:

- Lambda invocations
- API Gateway requests
- DynamoDB read/write capacity
- Lambda errors

## Cost Estimation

### Monthly Costs (approximate):

- Lambda (1000 requests/month): ~$0.20
- API Gateway (1000 requests/month): ~$1.00
- DynamoDB (on-demand): ~$2.50
- S3/Amplify hosting: ~$0.50
- **Total: ~$4-5/month**

## Support

For issues or questions:
- Check CloudWatch Logs for errors
- Review Stripe dashboard for payment issues
- Contact: aws@dacvisuals.com

---

**Generated by:** Client Billing Portal Deployment Script
**Documentation:** /home/daclab-ai/DEV/AWS-DevOps/docs/CLIENT-BILLING-PORTAL.md
